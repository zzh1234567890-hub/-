import sys
import os

sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from database_checker import DatabaseChecker


def main():
    print("ğŸ” å¼€å§‹æ•°æ®åº“è¯Šæ–­...")

    DB_CONFIG = {
        'host': 'localhost',
        'user': 'root',
        'password': 'lcy1106',
        'database': 'å•†å“æˆ¿ä»·æ ¼'
    }

    checker = DatabaseChecker(DB_CONFIG)

    # æ£€æŸ¥è¡¨ç»“æ„
    print("\n1. æ£€æŸ¥è¡¨ç»“æ„:")
    columns = checker.check_table_structure()

    if columns:
        print(f"\nâœ… æ‰¾åˆ° {len(columns)} ä¸ªå­—æ®µ")

        # æ£€æŸ¥å…³é”®å­—æ®µ
        key_fields = ['ID', 'æ€»ä»·', 'å•ä»·', 'é¢ç§¯', 'æˆ¿é¾„']
        missing_fields = []

        for field in key_fields:
            found = any(field in col for col in columns)
            if found:
                print(f"âœ… æ‰¾åˆ°åŒ…å« '{field}' çš„å­—æ®µ")
            else:
                missing_fields.append(field)
                print(f"âŒ æœªæ‰¾åˆ°åŒ…å« '{field}' çš„å­—æ®µ")

        if missing_fields:
            print(f"\nâš ï¸  ç¼ºå¤±å…³é”®å­—æ®µ: {missing_fields}")
            print("å»ºè®®æ£€æŸ¥æ•°æ®åº“è¡¨ç»“æ„æˆ–å­—æ®µå‘½å")

    # æ£€æŸ¥æ•°æ®æ ·æœ¬
    print("\n2. æ£€æŸ¥æ•°æ®æ ·æœ¬:")
    sample_data = checker.check_data_sample()

    if sample_data:
        print(f"âœ… æˆåŠŸè·å– {len(sample_data)} æ¡æ ·æœ¬æ•°æ®")
    else:
        print("âŒ æ— æ³•è·å–æ ·æœ¬æ•°æ®")

    print("\nğŸ‰ æ•°æ®åº“è¯Šæ–­å®Œæˆï¼")


if __name__ == "__main__":
    main()
